# 国际化（i18n）实现说明

## 概述

本插件已全面支持国际化，目前支持中文和英文两种语言。系统会根据IDE的语言设置自动切换显示语言。

## 支持的语言

- **英文（默认）**: `messages.properties`
- **简体中文**: `messages_zh_CN.properties`

## 实现架构

### 1. 资源文件

资源文件位于 `src/main/resources/` 目录：

- `messages.properties` - 英文资源文件（默认）
- `messages_zh_CN.properties` - 简体中文资源文件

### 2. JavaDocBundle 工具类

`dev.dong4j.zeka.stack.idea.plugin.util.JavaDocBundle` 是国际化资源管理类，继承自 IntelliJ 的 `DynamicBundle`。

主要方法：

```java
// 获取国际化消息
String message = JavaDocBundle.message("notification.title");

// 获取带参数的国际化消息
String formatted = JavaDocBundle.message("notification.completion.format", completed, failed, skipped);

// 延迟加载消息（用于构造函数）
Supplier<String> pointer = JavaDocBundle.messagePointer("action.generate.javadoc");
```

### 3. 国际化范围

#### 3.1 设置面板（Settings Panel）

所有设置面板的UI文本都已国际化：

- 标签文本（AI提供商、模型、Base URL等）
- 复选框文本（生成选项、语言支持）
- 按钮文本（测试连接）
- 提示信息（Tooltip）
- 对话框消息（连接成功/失败）

文件：`JavaDocSettingsPanel.java`, `JavaDocSettingsConfigurable.java`

#### 3.2 通知消息（Notifications）

所有通知消息都已国际化：

- 生成完成通知
- 错误通知
- 警告通知
- 索引中通知

文件：`NotificationUtil.java`

#### 3.3 Action 菜单项

所有 Action 的文本和描述都已国际化：

- 快捷键 Action（Ctrl+Shift+D / Cmd+Shift+D）
- 编辑器右键菜单
- 项目视图右键菜单
- Generate 菜单（Command+N / Alt+Insert）
- Intention Action（Option+Enter / Alt+Enter）

文件：

- `GenerateJavaDocShortcutAction.java`
- `GenerateJavaDocForFileAction.java`
- `GenerateJavaDocForSelectionAction.java`
- `GenerateJavaDocGenerateAction.java`
- `GenerateJavaDocIntentionAction.java`

#### 3.4 进度显示

后台任务的进度消息已国际化：

- 正在生成 JavaDoc...
- 正在处理 {0}/{1}

#### 3.5 确认对话框

批量生成时的确认对话框已国际化：

- 将为 {0} 个元素生成文档，这可能需要一些时间。是否继续？

## 资源Key命名规范

### 插件名称

- `plugin.name` - 插件名称

### 设置面板

- `settings.*` - 设置面板相关文本
    - `settings.display.name` - 设置面板显示名称
    - `settings.provider.label` - AI提供商标签
    - `settings.model.label` - 模型标签
    - `settings.test.connection` - 测试连接按钮
    - 等等...

### 通知消息

- `notification.*` - 通知相关文本
    - `notification.title` - 通知标题
    - `notification.generation.complete` - 生成完成
    - `notification.completion.format` - 完成统计格式
    - 等等...

### Action 消息

- `action.*` - Action相关文本
    - `action.generate.javadoc` - Action显示文本
    - `action.generate.javadoc.description` - Action描述
    - 等等...

### 确认消息

- `confirmation.*` - 确认对话框文本
    - `confirmation.batch.generation.title` - 批量生成确认标题
    - `confirmation.batch.generation.message` - 批量生成确认消息
    - 等等...

### 进度消息

- `progress.*` - 进度相关文本
    - `progress.generating` - 正在生成
    - `progress.processing` - 正在处理
    - 等等...

### 错误消息

- `error.*` - 错误相关文本
    - `error.validation.failed` - 验证失败
    - `error.provider.missing` - 提供商缺失
    - 等等...

## 使用示例

### 简单消息

```java
String title = JavaDocBundle.message("notification.title");
// 中文环境：AI Javadoc
// 英文环境：AI Javadoc
```

### 带参数的消息

```java
String message = JavaDocBundle.message("notification.completion.format", 5, 1, 2);
// 中文环境：完成: 5 | 失败: 1 | 跳过: 2
// 英文环境：Completed: 5 | Failed: 1 | Skipped: 2
```

### 在构造函数中使用（延迟加载）

```java
public GenerateJavaDocGenerateAction() {
    super(JavaDocBundle.messagePointer("action.generate.javadoc"), 
          JavaDocBundle.messagePointer("action.generate.javadoc.description"), 
          null);
}
```

### 在update方法中使用

```java
@Override
public void update(@NotNull AnActionEvent e) {
    e.getPresentation().setText(JavaDocBundle.message("action.generate.javadoc"));
    e.getPresentation().setDescription(JavaDocBundle.message("action.generate.javadoc.description"));
}
```

## 添加新语言

要添加新语言支持，只需：

1. 在 `src/main/resources/` 目录下创建新的资源文件：
    - 例如：`messages_ja.properties`（日语）
    - 例如：`messages_ko.properties`（韩语）

2. 复制 `messages.properties` 的内容到新文件

3. 将所有值翻译为目标语言

4. 重新构建插件

IntelliJ 会根据系统语言自动选择合适的资源文件。

## 测试

### 切换语言测试

在 IntelliJ IDEA 中切换语言：

1. 打开 Settings/Preferences
2. 选择 Appearance & Behavior → Appearance
3. 更改 UI Options → Language
4. 重启 IDE

### 验证检查清单

- [ ] 设置面板中的所有标签都正确显示
- [ ] 所有按钮文本正确显示
- [ ] Tooltip提示正确显示
- [ ] 通知消息正确显示
- [ ] Action菜单项文本正确显示
- [ ] 进度消息正确显示
- [ ] 确认对话框正确显示
- [ ] 错误消息正确显示

## 注意事项

1. **参数格式**：使用 `{0}`, `{1}`, `{2}` 作为参数占位符
   ```properties
   notification.completion.format=完成: {0} | 失败: {1} | 跳过: {2}
   ```

2. **特殊字符转义**：
    - 冒号需要转义：`\:`
    - 等号需要转义：`\=`
    - 反斜杠需要转义：`\\`

3. **换行**：使用 `\n` 表示换行
   ```properties
   notification.target.completion.format={0}\n完成: {1} | 失败: {2} | 跳过: {3}
   ```

4. **延迟加载**：在 Action 的构造函数中使用 `messagePointer()` 而不是 `message()`，以支持动态语言切换

5. **MessageFormat**：对于复杂的格式化，使用 `MessageFormat.format()` 配合 `JavaDocBundle.message()`
   ```java
   String content = MessageFormat.format(
       JavaDocBundle.message("notification.target.completion.format"),
       target, completed, failed, skipped
   );
   ```

## 文件列表

### 新增文件

- `src/main/resources/messages.properties` - 英文资源文件
- `src/main/resources/messages_zh_CN.properties` - 中文资源文件
- `src/main/java/com/github/intellijjavadocai/util/JavaDocBundle.java` - 国际化工具类

### 修改文件

- `src/main/java/com/github/intellijjavadocai/util/NotificationUtil.java`
- `src/main/java/com/github/intellijjavadocai/settings/ui/JavaDocSettingsPanel.java`
- `src/main/java/com/github/intellijjavadocai/settings/JavaDocSettingsConfigurable.java`
- `src/main/java/com/github/intellijjavadocai/action/GenerateJavaDocShortcutAction.java`
- `src/main/java/com/github/intellijjavadocai/action/GenerateJavaDocForFileAction.java`
- `src/main/java/com/github/intellijjavadocai/action/GenerateJavaDocForSelectionAction.java`
- `src/main/java/com/github/intellijjavadocai/action/GenerateJavaDocGenerateAction.java`
- `src/main/java/com/github/intellijjavadocai/action/GenerateJavaDocIntentionAction.java`
- `src/main/resources/META-INF/plugin.xml`

