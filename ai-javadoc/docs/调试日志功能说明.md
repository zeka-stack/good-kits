# è°ƒè¯•æ—¥å¿—åŠŸèƒ½è¯´æ˜

## ğŸ“‹ æ¦‚è¿°

ä¸ºäº†æ–¹ä¾¿å¼€å‘è€…è°ƒè¯•å’Œæ’æŸ¥é—®é¢˜ï¼Œæ’ä»¶æ–°å¢äº†è¯¦ç»†çš„è°ƒè¯•æ—¥å¿—åŠŸèƒ½ã€‚å½“å¯ç”¨**è¯¦ç»†æ—¥å¿—**é€‰é¡¹åï¼Œæ’ä»¶ä¼šè®°å½•ä¸ AI æœåŠ¡äº¤äº’çš„æ‰€æœ‰å…³é”®ä¿¡æ¯ã€‚

---

## ğŸ¯ å¯ç”¨æ–¹å¼

### åœ¨è®¾ç½®é¢æ¿ä¸­å¯ç”¨

1. æ‰“å¼€ **Preferences** â†’ **Tools** â†’ **AI Javadoc**
2. æ»šåŠ¨åˆ° **é«˜çº§é…ç½®** éƒ¨åˆ†
3. å‹¾é€‰ **"å¯ç”¨è¯¦ç»†æ—¥å¿—"** é€‰é¡¹
4. ç‚¹å‡» **"Apply"** æˆ– **"OK"**

### é…ç½®é¡¹

- **å­—æ®µå**: `verboseLogging`
- **ç±»å‹**: `boolean`
- **é»˜è®¤å€¼**: `false`ï¼ˆå…³é—­ï¼‰
- **ä½ç½®**: `SettingsState.java`

---

## ğŸ“ æ—¥å¿—å†…å®¹

### 1. æ–‡æ¡£ç”Ÿæˆå¼€å§‹

**è§¦å‘æ—¶æœº**ï¼šæ¯æ¬¡å¼€å§‹ç”Ÿæˆæ–‡æ¡£æ—¶

**è®°å½•å†…å®¹**ï¼š

```
=== Generate Documentation ===
Type: METHOD
Language: java
Code Length: 156 characters
Code Preview: public void calculateTotal() {...
Built Prompt Length: 789 characters
```

**å­—æ®µè¯´æ˜**ï¼š

- `Type`: æ–‡æ¡£ç±»å‹ï¼ˆCLASS, METHOD, FIELD, TEST_METHODï¼‰
- `Language`: ç¼–ç¨‹è¯­è¨€
- `Code Length`: ä»£ç é•¿åº¦
- `Code Preview`: ä»£ç é¢„è§ˆï¼ˆå‰ 300 å­—ç¬¦ï¼‰
- `Built Prompt Length`: æ„å»ºçš„æç¤ºè¯é•¿åº¦

---

### 2. è¯·æ±‚å°è¯•

**è§¦å‘æ—¶æœº**ï¼šæ¯æ¬¡å°è¯•å‘é€è¯·æ±‚æ—¶

**è®°å½•å†…å®¹**ï¼š

```
Attempt 1/3 to generate documentation
```

---

### 3. AI è¯·æ±‚è¯¦æƒ…

**è§¦å‘æ—¶æœº**ï¼šå‘é€ HTTP è¯·æ±‚å‰

**è®°å½•å†…å®¹**ï¼š

```
=== AI Request ===
URL: https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions
Model: qwen-max
Temperature: 0.1
Max Tokens: 1000
Headers: [Content-Type:"application/json", Authorization:"Bearer ***masked***"]
Request Body: {"model":"qwen-max","messages":[{"role":"user","content":"..."}],"temperature":0.1,"max_tokens":1000}
Prompt Length: 789 characters
Prompt (first 500 chars): ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ Java å¼€å‘å·¥ç¨‹å¸ˆ...
```

**å­—æ®µè¯´æ˜**ï¼š

- `URL`: è¯·æ±‚çš„å®Œæ•´ URL
- `Model`: ä½¿ç”¨çš„æ¨¡å‹åç§°
- `Temperature`: æ¸©åº¦å‚æ•°
- `Max Tokens`: æœ€å¤§ token æ•°
- `Headers`: è¯·æ±‚å¤´ï¼ˆ**API Key å·²è„±æ•**ï¼‰
- `Request Body`: è¯·æ±‚ä½“ï¼ˆæˆªæ–­åˆ° 1000 å­—ç¬¦ï¼‰
- `Prompt Length`: å®Œæ•´ Prompt é•¿åº¦
- `Prompt (first 500 chars)`: Prompt å‰ 500 å­—ç¬¦

**å®‰å…¨ç‰¹æ€§**ï¼š

- âœ… API Key è‡ªåŠ¨è„±æ•ä¸º `***masked***`
- âœ… é•¿æ–‡æœ¬è‡ªåŠ¨æˆªæ–­
- âœ… æ˜¾ç¤ºåŸå§‹é•¿åº¦ä¿¡æ¯

---

### 4. AI å“åº”è¯¦æƒ…

**è§¦å‘æ—¶æœº**ï¼šæ”¶åˆ° HTTP å“åº”å

**è®°å½•å†…å®¹**ï¼š

```
=== AI Response ===
Status Code: 200 OK
Response Body: {"id":"chatcmpl-xxx","object":"chat.completion","created":1234567890,"model":"qwen-max","choices":[{"index":0,"message":{"role":"assistant","content":"/**\n * è®¡ç®—æ€»é‡‘é¢\n */"},"finish_reason":"stop"}],"usage":{"prompt_tokens":123,"completion_tokens":45,"total_tokens":168}}
Parsed Result Length: 28 characters
Parsed Result: /**
 * è®¡ç®—æ€»é‡‘é¢
 */
```

**å­—æ®µè¯´æ˜**ï¼š

- `Status Code`: HTTP çŠ¶æ€ç 
- `Response Body`: å®Œæ•´å“åº”ä½“ï¼ˆæˆªæ–­åˆ° 2000 å­—ç¬¦ï¼‰
- `Parsed Result Length`: è§£æåçš„ç»“æœé•¿åº¦
- `Parsed Result`: è§£æåçš„ JavaDoc æ³¨é‡Šï¼ˆæˆªæ–­åˆ° 1000 å­—ç¬¦ï¼‰

---

### 5. æˆåŠŸå®Œæˆ

**è§¦å‘æ—¶æœº**ï¼šæ–‡æ¡£ç”ŸæˆæˆåŠŸ

**è®°å½•å†…å®¹**ï¼š

```
Successfully generated documentation on attempt 1
```

---

### 6. é”™è¯¯æ—¥å¿—

#### HTTP å®¢æˆ·ç«¯é”™è¯¯ï¼ˆ4xxï¼‰

**è§¦å‘æ—¶æœº**ï¼šæ”¶åˆ° 4xx çŠ¶æ€ç 

**è®°å½•å†…å®¹**ï¼š

```
HTTP Client Error: Status=401 UNAUTHORIZED, Body={"error":{"message":"Invalid API key","type":"invalid_request_error"}}
```

**å¸¸è§é”™è¯¯**ï¼š

- `401`: API Key æ— æ•ˆ
- `403`: æƒé™ä¸è¶³
- `429`: è¯·æ±‚é¢‘ç‡è¶…é™

---

#### HTTP æœåŠ¡å™¨é”™è¯¯ï¼ˆ5xxï¼‰

**è§¦å‘æ—¶æœº**ï¼šæ”¶åˆ° 5xx çŠ¶æ€ç 

**è®°å½•å†…å®¹**ï¼š

```
HTTP Server Error: Status=500 INTERNAL_SERVER_ERROR, Body={"error":{"message":"Internal server error"}}
```

---

#### ç½‘ç»œé”™è¯¯

**è§¦å‘æ—¶æœº**ï¼šç½‘ç»œè¿æ¥å¤±è´¥

**è®°å½•å†…å®¹**ï¼š

```
Network Error: Connection refused: connect
```

**å¸¸è§åŸå› **ï¼š

- Base URL é…ç½®é”™è¯¯
- ç½‘ç»œä¸å¯è¾¾
- ä»£ç†é…ç½®é—®é¢˜

---

#### é‡è¯•æ—¥å¿—

**è§¦å‘æ—¶æœº**ï¼šè¯·æ±‚å¤±è´¥ä½†å¯ä»¥é‡è¯•

**è®°å½•å†…å®¹**ï¼š

```
Request failed, retrying in 5000ms (attempt 1/3): Rate limit exceeded
```

**å­—æ®µè¯´æ˜**ï¼š

- `retrying in 5000ms`: ç­‰å¾…æ—¶é—´ï¼ˆæŒ‡æ•°é€€é¿ï¼‰
- `attempt 1/3`: å½“å‰å°è¯•æ¬¡æ•° / æœ€å¤§é‡è¯•æ¬¡æ•°
- `Rate limit exceeded`: é”™è¯¯åŸå› 

---

#### æœ€ç»ˆå¤±è´¥

**è§¦å‘æ—¶æœº**ï¼šæ‰€æœ‰é‡è¯•éƒ½å¤±è´¥

**è®°å½•å†…å®¹**ï¼š

```
Generation failed after 3 attempts: Rate limit exceeded
```

---

## ğŸ“Š æ—¥å¿—çº§åˆ«

### DEBUG

**ç”¨é€”**ï¼šè¯¦ç»†çš„è°ƒè¯•ä¿¡æ¯

**å†…å®¹**ï¼š

- è¯·æ±‚/å“åº”è¯¦æƒ…
- Prompt å†…å®¹
- ä»£ç é¢„è§ˆ
- è§£æç»“æœ

**å¯ç”¨æ¡ä»¶**ï¼š

- âœ… `verboseLogging = true`
- âœ… æ—¥å¿—çº§åˆ«è®¾ç½®ä¸º DEBUG

---

### WARN

**ç”¨é€”**ï¼šè­¦å‘Šä¿¡æ¯

**å†…å®¹**ï¼š

- é‡è¯•é€šçŸ¥
- åˆ é™¤æ—§æ³¨é‡Šå¤±è´¥

**å¯ç”¨æ¡ä»¶**ï¼š

- âœ… æ€»æ˜¯å¯ç”¨ï¼ˆä¸å— `verboseLogging` æ§åˆ¶ï¼‰

---

### ERROR

**ç”¨é€”**ï¼šé”™è¯¯ä¿¡æ¯

**å†…å®¹**ï¼š

- HTTP é”™è¯¯
- ç½‘ç»œé”™è¯¯
- è§£æå¤±è´¥
- æœ€ç»ˆå¤±è´¥

**å¯ç”¨æ¡ä»¶**ï¼š

- âœ… æ€»æ˜¯å¯ç”¨ï¼ˆä¸å— `verboseLogging` æ§åˆ¶ï¼‰

---

## ğŸ”§ é…ç½® IDEA æ—¥å¿—çº§åˆ«

### æ–¹æ³• 1ï¼šé€šè¿‡é…ç½®æ–‡ä»¶

1. æ‰¾åˆ° `log4j.properties` æˆ– `log4j2.xml`
2. æ·»åŠ æˆ–ä¿®æ”¹ï¼š
   ```properties
   log4j.logger.dev.dong4j.zeka.stack.idea.plugin=DEBUG
   ```

### æ–¹æ³• 2ï¼šé€šè¿‡ IDEA è®¾ç½®

1. æ‰“å¼€ **Help** â†’ **Diagnostic Tools** â†’ **Debug Log Settings**
2. æ·»åŠ ï¼š
   ```
   dev.dong4j.zeka.stack.idea.plugin
   ```
3. ç‚¹å‡» **OK**

### æŸ¥çœ‹æ—¥å¿—

1. æ‰“å¼€ **Help** â†’ **Show Log in Finder/Explorer**
2. æŸ¥çœ‹ `idea.log` æ–‡ä»¶

---

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

### 1. è°ƒè¯• API è¿æ¥é—®é¢˜

**åœºæ™¯**ï¼šé…ç½®å®Œæˆåæ— æ³•è¿æ¥ AI æœåŠ¡

**æ“ä½œ**ï¼š

1. å¯ç”¨è¯¦ç»†æ—¥å¿—
2. å°è¯•ç”Ÿæˆ JavaDoc
3. æŸ¥çœ‹æ—¥å¿—ä¸­çš„ URLã€Headersã€é”™è¯¯ä¿¡æ¯

**ç¤ºä¾‹æ—¥å¿—**ï¼š

```
URL: https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions
HTTP Client Error: Status=401 UNAUTHORIZED
```

**è¯Šæ–­**ï¼šAPI Key é…ç½®é”™è¯¯

---

### 2. åˆ†æç”Ÿæˆè´¨é‡é—®é¢˜

**åœºæ™¯**ï¼šç”Ÿæˆçš„ JavaDoc è´¨é‡ä¸ç†æƒ³

**æ“ä½œ**ï¼š

1. å¯ç”¨è¯¦ç»†æ—¥å¿—
2. ç”Ÿæˆ JavaDoc
3. æ£€æŸ¥æ—¥å¿—ä¸­çš„ï¼š
    - Prompt å†…å®¹
    - ä¼ å…¥çš„ä»£ç 
    - AI è¿”å›çš„ç»“æœ

**ç¤ºä¾‹æ—¥å¿—**ï¼š

```
Code Preview: public void method() {...
Prompt (first 500 chars): ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ Java å¼€å‘å·¥ç¨‹å¸ˆ...
Parsed Result: /** æ–¹æ³•è¯´æ˜ */
```

**è¯Šæ–­**ï¼šå¯ä»¥æ ¹æ® Prompt å’Œç»“æœè°ƒæ•´ Prompt æ¨¡æ¿

---

### 3. æ’æŸ¥è¶…æ—¶é—®é¢˜

**åœºæ™¯**ï¼šè¯·æ±‚ç»å¸¸è¶…æ—¶

**æ“ä½œ**ï¼š

1. å¯ç”¨è¯¦ç»†æ—¥å¿—
2. è§‚å¯Ÿæ—¥å¿—
3. æ£€æŸ¥ï¼š
    - è¯·æ±‚å‘é€æ—¶é—´
    - å“åº”æ¥æ”¶æ—¶é—´
    - é‡è¯•æ¬¡æ•°

**ç¤ºä¾‹æ—¥å¿—**ï¼š

```
Attempt 1/3 to generate documentation
Network Error: Read timed out
Request failed, retrying in 5000ms (attempt 1/3)
```

**è¯Šæ–­**ï¼šéœ€è¦å¢åŠ è¶…æ—¶æ—¶é—´æˆ–æ£€æŸ¥ç½‘ç»œ

---

### 4. è°ƒè¯• Prompt æ¨¡æ¿

**åœºæ™¯**ï¼šè‡ªå®šä¹‰ Prompt æ¨¡æ¿åæ•ˆæœä¸ç†æƒ³

**æ“ä½œ**ï¼š

1. å¯ç”¨è¯¦ç»†æ—¥å¿—
2. ç”Ÿæˆ JavaDoc
3. æŸ¥çœ‹å®é™…å‘é€çš„ Prompt
4. å¯¹æ¯”é¢„æœŸå’Œå®é™…

**ç¤ºä¾‹æ—¥å¿—**ï¼š

```
Built Prompt Length: 789 characters
Prompt (first 500 chars): ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ Java å¼€å‘å·¥ç¨‹å¸ˆï¼Œè¯·ä¸ºä»¥ä¸‹ä»£ç ç”Ÿæˆå®Œæ•´çš„ JavaDoc æ³¨é‡Šï¼ˆä¸­æ–‡ï¼‰...
```

**è¯Šæ–­**ï¼šæ£€æŸ¥ Prompt æ ¼å¼ã€å ä½ç¬¦æ›¿æ¢æ˜¯å¦æ­£ç¡®

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### 1. æ€§èƒ½å½±å“

**å½±å“**ï¼š

- âŒ æ—¥å¿—è®°å½•ä¼šç•¥å¾®å½±å“æ€§èƒ½
- âŒ å¤§é‡æ—¥å¿—å¯èƒ½å ç”¨ç£ç›˜ç©ºé—´

**å»ºè®®**ï¼š

- âœ… ä»…åœ¨è°ƒè¯•æ—¶å¯ç”¨
- âœ… è°ƒè¯•å®Œæˆåå…³é—­
- âœ… å®šæœŸæ¸…ç†æ—¥å¿—æ–‡ä»¶

---

### 2. æ•æ„Ÿä¿¡æ¯ä¿æŠ¤

**å·²ä¿æŠ¤**ï¼š

- âœ… API Key è‡ªåŠ¨è„±æ•
- âœ… åªè®°å½•è¯·æ±‚å¤´çš„é”®åï¼Œä¸è®°å½•å®Œæ•´å€¼

**ä»éœ€æ³¨æ„**ï¼š

- âš ï¸ Prompt ä¸­å¯èƒ½åŒ…å«ä¸šåŠ¡ä»£ç 
- âš ï¸ æ—¥å¿—æ–‡ä»¶å¯èƒ½åŒ…å«æ•æ„Ÿä¿¡æ¯
- âš ï¸ ä¸è¦å°†æ—¥å¿—æ–‡ä»¶åˆ†äº«ç»™ä»–äºº

---

### 3. æ—¥å¿—æ–‡ä»¶å¤§å°

**é—®é¢˜**ï¼šè¯¦ç»†æ—¥å¿—ä¼šå¿«é€Ÿå¢é•¿

**è§£å†³æ–¹æ¡ˆ**ï¼š

- å®šæœŸæ¸…ç†æ—§æ—¥å¿—
- ä½¿ç”¨æ—¥å¿—è½®è½¬
- åªåœ¨éœ€è¦æ—¶å¯ç”¨

---

## ğŸ“ æ—¥å¿—ç¤ºä¾‹

### å®Œæ•´çš„æˆåŠŸæµç¨‹

```
=== Generate Documentation ===
Type: METHOD
Language: java
Code Length: 156 characters
Code Preview: public void calculateTotal() {
    return items.stream()
        .map(Item::getPrice)
        .reduce(0.0, Double::sum);
}
Built Prompt Length: 789 characters

Attempt 1/3 to generate documentation

=== AI Request ===
URL: https://dashscope.aliyuncs.com/compatible-mode/v1/chat/completions
Model: qwen-max
Temperature: 0.1
Max Tokens: 1000
Headers: [Content-Type:"application/json", Authorization:"Bearer ***masked***"]
Request Body: {"model":"qwen-max","messages":[{"role":"user","content":"ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ Java å¼€å‘å·¥ç¨‹å¸ˆ..."}],"temperature":0.1,"max_tokens":1000}
Prompt Length: 789 characters
Prompt (first 500 chars): ä½ æ˜¯ä¸€ä¸ªä¸“ä¸šçš„ Java å¼€å‘å·¥ç¨‹å¸ˆï¼Œè¯·ä¸ºä»¥ä¸‹ä»£ç ç”Ÿæˆå®Œæ•´çš„ JavaDoc æ³¨é‡Šï¼ˆä¸­æ–‡ï¼‰ã€‚

è¦æ±‚ï¼š
1. å¿…é¡»åŒ…å«å®Œæ•´çš„ JavaDoc æ ¼å¼ï¼ŒåŒ…æ‹¬å¼€å§‹æ ‡è®° /** å’Œç»“æŸæ ‡è®° */
2. ä½¿ç”¨ä¸­æ–‡ç¼–å†™æ³¨é‡Šå†…å®¹
...

=== AI Response ===
Status Code: 200 OK
Response Body: {"id":"chatcmpl-xxx","object":"chat.completion","created":1234567890,"model":"qwen-max","choices":[{"index":0,"message":{"role":"assistant","content":"/**\n * è®¡ç®—æ‰€æœ‰å•†å“çš„æ€»é‡‘é¢\n * \n * @return æ€»é‡‘é¢\n */"},"finish_reason":"stop"}],"usage":{"prompt_tokens":123,"completion_tokens":45,"total_tokens":168}}
Parsed Result Length: 65 characters
Parsed Result: /**
 * è®¡ç®—æ‰€æœ‰å•†å“çš„æ€»é‡‘é¢
 * 
 * @return æ€»é‡‘é¢
 */

Successfully generated documentation on attempt 1
```

---

### é‡è¯•åæˆåŠŸçš„æµç¨‹

```
=== Generate Documentation ===
Type: METHOD
Language: java
Code Length: 85 characters
Code Preview: public void save() { ... }
Built Prompt Length: 456 characters

Attempt 1/3 to generate documentation

=== AI Request ===
...

HTTP Client Error: Status=429 TOO_MANY_REQUESTS, Body={"error":{"message":"Rate limit exceeded"}}

Request failed, retrying in 5000ms (attempt 1/3): Rate limit exceeded

Attempt 2/3 to generate documentation

=== AI Request ===
...

=== AI Response ===
Status Code: 200 OK
...

Successfully generated documentation on attempt 2
```

---

## ğŸ”— ç›¸å…³æ–‡ä»¶

**å®ç°æ–‡ä»¶**ï¼š

- `OpenAICompatibleProvider.java` - ä¸»è¦æ—¥å¿—é€»è¾‘

**å…³é”®æ–¹æ³•**ï¼š

- `generateDocumentation()` - ç”Ÿæˆæµç¨‹æ—¥å¿—
- `sendRequest()` - è¯·æ±‚/å“åº”æ—¥å¿—
- `maskSensitiveHeaders()` - API Key è„±æ•
- `truncateForLog()` - é•¿æ–‡æœ¬æˆªæ–­
