# æ™ºèƒ½å®šä½åŠŸèƒ½è¯´æ˜

## ğŸ“‹ åŠŸèƒ½æ¦‚è§ˆ

æ–°å¢äº†**æ™ºèƒ½å®šä½**åŠŸèƒ½ï¼Œæ‰€æœ‰å…¥å£ï¼ˆå¿«æ·é”®ã€å³é”®èœå•ã€Generate èœå•ã€Intention Actionï¼‰éƒ½èƒ½æ ¹æ®å…‰æ ‡ä½ç½®è‡ªåŠ¨è¯†åˆ«éœ€è¦ç”Ÿæˆæ–‡æ¡£çš„ä»£ç å…ƒç´ ã€‚

---

## ğŸ¯ æ™ºèƒ½å®šä½é€»è¾‘

### å®šä½ä¼˜å…ˆçº§

1. **æ–¹æ³• (PsiMethod)** - æœ€é«˜ä¼˜å…ˆçº§
2. **å­—æ®µ (PsiField)** - ä¸­ç­‰ä¼˜å…ˆçº§
3. **ç±» (PsiClass)** - è¾ƒä½ä¼˜å…ˆçº§
4. **æ–‡ä»¶ (PsiFile)** - é»˜è®¤

### å…·ä½“è¡Œä¸º

| å…‰æ ‡ä½ç½®       | è¯†åˆ«ç»“æœ    | ç”ŸæˆèŒƒå›´      |
|------------|---------|-----------|
| æ–¹æ³•å†…éƒ¨æˆ–æ–¹æ³•ç­¾åä¸Š | æ–¹æ³•      | åªä¸ºè¯¥æ–¹æ³•ç”Ÿæˆ   |
| å­—æ®µå£°æ˜è¡Œ      | å­—æ®µ      | åªä¸ºè¯¥å­—æ®µç”Ÿæˆ   |
| ç±»åæˆ–ç±»å£°æ˜è¡Œ    | ç±»ï¼ˆä»…ç±»è‡ªèº«ï¼‰ | åªä¸ºç±»ç”Ÿæˆ     |
| ç±»å†…éƒ¨ï¼ˆéç‰¹å®šæˆå‘˜ï¼‰ | ç±»ï¼ˆæ•´ä¸ªç±»ï¼‰  | ä¸ºç±»åŠæ‰€æœ‰æˆå‘˜ç”Ÿæˆ |
| å…¶ä»–ä½ç½®       | æ–‡ä»¶      | ä¸ºæ•´ä¸ªæ–‡ä»¶ç”Ÿæˆ   |

---

## ğŸš€ ä½¿ç”¨ç¤ºä¾‹

### ç¤ºä¾‹ 1ï¼šä¸ºå•ä¸ªæ–¹æ³•ç”Ÿæˆ

```java
public class Calculator {
    
    public int add(int a, int b) {  // å…‰æ ‡åœ¨è¿™ä¸€è¡Œ
        return a + b;
    }
    
    public int subtract(int a, int b) {
        return a - b;
    }
}
```

**æ“ä½œ**ï¼šå°†å…‰æ ‡æ”¾åœ¨ `add` æ–¹æ³•ä¸Šï¼ŒæŒ‰ `Cmd+Shift+D`

**ç»“æœ**ï¼šåªä¸º `add` æ–¹æ³•ç”Ÿæˆ JavaDocï¼Œ`subtract` æ–¹æ³•ä¸å—å½±å“

---

### ç¤ºä¾‹ 2ï¼šä¸ºå•ä¸ªå­—æ®µç”Ÿæˆ

```java
public class User {
    
    private String name;  // å…‰æ ‡åœ¨è¿™ä¸€è¡Œ
    
    private int age;
    
    public String getName() {
        return name;
    }
}
```

**æ“ä½œ**ï¼šå°†å…‰æ ‡æ”¾åœ¨ `name` å­—æ®µä¸Šï¼ŒæŒ‰ `Cmd+Shift+D`

**ç»“æœ**ï¼šåªä¸º `name` å­—æ®µç”Ÿæˆ JavaDoc

---

### ç¤ºä¾‹ 3ï¼šä¸ºæ•´ä¸ªç±»ç”Ÿæˆ

```java
public class Product {  // å…‰æ ‡åœ¨ç±»åä¸Š
    
    private String name;
    
    private double price;
    
    public String getName() {
        return name;
    }
}
```

**æ“ä½œ**ï¼šå°†å…‰æ ‡æ”¾åœ¨ç±»å `Product` ä¸Šï¼ŒæŒ‰ `Cmd+Shift+D`

**ç»“æœ**ï¼šä¸ºç±»ã€æ‰€æœ‰å­—æ®µå’Œæ‰€æœ‰æ–¹æ³•ç”Ÿæˆ JavaDoc

---

### ç¤ºä¾‹ 4ï¼šç±»å†…éƒ¨ç©ºç™½å¤„

```java
public class Order {
    // å…‰æ ‡åœ¨è¿™ä¸€è¡Œï¼ˆç±»å†…éƒ¨ï¼Œä½†ä¸åœ¨ä»»ä½•æˆå‘˜ä¸Šï¼‰
    
    private String orderId;
    
    public String getOrderId() {
        return orderId;
    }
}
```

**æ“ä½œ**ï¼šå°†å…‰æ ‡æ”¾åœ¨ç±»å†…éƒ¨ç©ºç™½å¤„ï¼ŒæŒ‰ `Cmd+Shift+D`

**ç»“æœ**ï¼šä¸ºæ•´ä¸ªç±»åŠæ‰€æœ‰æˆå‘˜ç”Ÿæˆ JavaDoc

---

## ğŸ”Œ æ‰€æœ‰å…¥å£

### 1. å¿«æ·é”® (Ctrl+Shift+D / Cmd+Shift+D)

**æ–‡ä»¶**ï¼š`Action.java`

**æ™ºèƒ½å®šä½**ï¼šâœ… å·²å®ç°

```java
// å…‰æ ‡åœ¨æ–¹æ³•ä¸Š â†’ åªä¸ºè¯¥æ–¹æ³•ç”Ÿæˆ
// å…‰æ ‡åœ¨å­—æ®µä¸Š â†’ åªä¸ºè¯¥å­—æ®µç”Ÿæˆ
// å…‰æ ‡åœ¨ç±»å£°æ˜ä¸Š â†’ åªä¸ºè¯¥ç±»ç”Ÿæˆ
// å…‰æ ‡åœ¨ç±»å†…éƒ¨ â†’ ä¸ºæ•´ä¸ªç±»åŠæ‰€æœ‰æˆå‘˜ç”Ÿæˆ
// å…¶ä»–ä½ç½® â†’ ä¸ºæ•´ä¸ªæ–‡ä»¶ç”Ÿæˆ
```

---

### 2. ç¼–è¾‘å™¨å³é”®èœå•

**æ–‡ä»¶**ï¼š`GenerateJavaDocForFileAction.java`

**èœå•ä½ç½®**ï¼šç¼–è¾‘å™¨å³é”® â†’ Generate JavaDoc with AI

**æ™ºèƒ½å®šä½**ï¼šâœ… å·²å®ç°

**è¡Œä¸º**ï¼šä¸å¿«æ·é”®ç›¸åŒ

---

### 3. Generate èœå• (Cmd+N / Alt+Insert)

**æ–‡ä»¶**ï¼š`GenerateJavaDocGenerateAction.java`

**èœå•ä½ç½®**ï¼šCmd+N (Mac) æˆ– Alt+Insert (Win/Linux) â†’ JavaDoc with AI

**æ™ºèƒ½å®šä½**ï¼šâœ… å·²å®ç°

**è¡Œä¸º**ï¼šä¸å¿«æ·é”®ç›¸åŒ

---

### 4. Intention Action (Option+Enter / Alt+Enter)

**æ–‡ä»¶**ï¼š`GenerateJavaDocIntentionAction.java`

**èœå•ä½ç½®**ï¼šOption+Enter (Mac) æˆ– Alt+Enter (Win/Linux) â†’ Generate JavaDoc with AI

**æ™ºèƒ½å®šä½**ï¼šâœ… å·²å®ç°

**ç‰¹æ®Šè¡Œä¸º**ï¼š

- åªåœ¨å¯ä»¥ç”Ÿæˆ JavaDoc çš„å…ƒç´ ä¸Šæ˜¾ç¤º
- è‡ªåŠ¨è¿‡æ»¤å·²æœ‰ JavaDoc çš„å…ƒç´ 
- ä¸åœ¨æ–‡ä»¶çº§åˆ«æ˜¾ç¤ºï¼ˆé¿å…é‡å¤ï¼‰

**æ˜¾ç¤ºæ¡ä»¶**ï¼š

1. å…‰æ ‡åœ¨ç±»ã€æ–¹æ³•æˆ–å­—æ®µä¸Š
2. è¯¥å…ƒç´ è¿˜æ²¡æœ‰ JavaDoc æ³¨é‡Š
3. å½“å‰æ–‡ä»¶æ˜¯ Java æ–‡ä»¶

---

### 5. æ–‡ä»¶/ç›®å½•å³é”®èœå•

**æ–‡ä»¶**ï¼š`GenerateJavaDocForSelectionAction.java`

**èœå•ä½ç½®**ï¼šé¡¹ç›®è§†å›¾ä¸­ï¼Œå³é”®æ–‡ä»¶/ç›®å½• â†’ Generate JavaDoc with AI

**æ™ºèƒ½å®šä½**ï¼šâŒ ä¸é€‚ç”¨ï¼ˆæ‰¹é‡å¤„ç†ï¼‰

**è¡Œä¸º**ï¼šä¸ºé€‰ä¸­çš„æ‰€æœ‰ Java æ–‡ä»¶ç”Ÿæˆæ–‡æ¡£

---

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### æ ¸å¿ƒç»„ä»¶

#### 1. PsiElementLocator

**ä½ç½®**ï¼š`dev.dong4j.zeka.stack.idea.plugin.util.PsiElementLocator`

**èŒè´£**ï¼šæ™ºèƒ½å®šä½ PSI å…ƒç´ 

**æ ¸å¿ƒæ–¹æ³•**ï¼š

```java
// æ ¹æ®ç¼–è¾‘å™¨å…‰æ ‡ä½ç½®å®šä½å…ƒç´ 
public static LocateResult locateElement(Editor editor, PsiFile psiFile)

// æ ¹æ®åç§»é‡å®šä½å…ƒç´ 
public static LocateResult locateElementAtOffset(PsiFile psiFile, int offset)

// æ£€æŸ¥æ˜¯å¦å·²æœ‰ JavaDoc
public static boolean hasJavaDoc(PsiElement element)

// è·å–å…ƒç´ æè¿°
public static String getElementDescription(PsiElement element)
```

**å®šä½æµç¨‹**ï¼š

```
1. è·å–å…‰æ ‡ä½ç½®çš„ PSI å…ƒç´ 
   â†“
2. å‘ä¸Šéå† PSI æ ‘
   â†“
3. ä¼˜å…ˆæŸ¥æ‰¾æ–¹æ³• (PsiMethod)
   â†“
4. å¦‚æœæ²¡æœ‰ï¼ŒæŸ¥æ‰¾å­—æ®µ (PsiField)
   â†“
5. å¦‚æœæ²¡æœ‰ï¼ŒæŸ¥æ‰¾ç±» (PsiClass)
   â†“
6. åˆ¤æ–­æ˜¯å¦åœ¨ç±»å£°æ˜è¡Œ
   - æ˜¯ â†’ è¿”å›ç±»ï¼ˆä»…ç±»è‡ªèº«ï¼‰
   - å¦ â†’ è¿”å›ç±»ï¼ˆæ•´ä¸ªç±»ï¼‰
   â†“
7. é»˜è®¤è¿”å›æ–‡ä»¶ (PsiFile)
```

---

#### 2. TaskCollector å¢å¼º

**ä½ç½®**ï¼š`dev.dong4j.zeka.stack.idea.plugin.task.TaskCollector`

**æ–°å¢æ–¹æ³•**ï¼š

```java
// ä»å•ä¸ªå…ƒç´ æ”¶é›†ä»»åŠ¡
public List<DocumentationTask> collectFromElement(PsiElement element)

// ä»ç±»æ”¶é›†ä»»åŠ¡ï¼ˆåŒ…æ‹¬æ‰€æœ‰æˆå‘˜ï¼‰
private void collectFromClass(PsiClass psiClass, List<DocumentationTask> tasks)
```

**æ”¶é›†é€»è¾‘**ï¼š

```java
if (element instanceof PsiMethod) {
    // åªæ”¶é›†è¯¥æ–¹æ³•
} else if (element instanceof PsiField) {
    // åªæ”¶é›†è¯¥å­—æ®µ
} else if (element instanceof PsiClass) {
    // æ”¶é›†ç±»åŠæ‰€æœ‰æˆå‘˜
} else if (element instanceof PsiFile) {
    // æ”¶é›†æ•´ä¸ªæ–‡ä»¶
}
```

---

#### 3. æ‰€æœ‰ Action çš„æ›´æ–°

**å…±åŒæ¨¡å¼**ï¼š

```java
@Override
public void actionPerformed(@NotNull AnActionEvent e) {
    // 1. è·å–ç¼–è¾‘å™¨å’Œæ–‡ä»¶
    Editor editor = e.getData(CommonDataKeys.EDITOR);
    PsiFile psiFile = e.getData(CommonDataKeys.PSI_FILE);
    
    // 2. æ™ºèƒ½å®šä½
    PsiElementLocator.LocateResult locateResult = 
        PsiElementLocator.locateElement(editor, psiFile);
    
    // 3. æ ¹æ®å®šä½ç»“æœæ”¶é›†ä»»åŠ¡
    TaskCollector collector = new TaskCollector(project);
    List<DocumentationTask> tasks = collector.collectFromElement(locateResult.getElement());
    
    // 4. æ‰§è¡Œä»»åŠ¡
    TaskExecutor executor = new TaskExecutor(project, indicator);
    executor.processTasks(tasks);
}
```

---

## ğŸ“Š ç”¨æˆ·ä½“éªŒæå‡

### Beforeï¼ˆv1.0ï¼‰

| åœºæ™¯       | v1.0 è¡Œä¸º | ç”¨æˆ·ç—›ç‚¹           |
|----------|---------|----------------|
| æƒ³ä¸ºå•ä¸ªæ–¹æ³•ç”Ÿæˆ | ä¸ºæ•´ä¸ªæ–‡ä»¶ç”Ÿæˆ | âŒ ç”Ÿæˆå¤ªå¤šä¸éœ€è¦çš„æ³¨é‡Š   |
| æƒ³ä¸ºå•ä¸ªå­—æ®µç”Ÿæˆ | ä¸ºæ•´ä¸ªæ–‡ä»¶ç”Ÿæˆ | âŒ æµªè´¹æ—¶é—´å’Œ API è°ƒç”¨ |
| æƒ³ä¸ºä¸€ä¸ªç±»ç”Ÿæˆ  | ä¸ºæ•´ä¸ªæ–‡ä»¶ç”Ÿæˆ | âŒ å¤šä¸ªç±»æ—¶ä¸å¤Ÿç²¾ç¡®     |

### Afterï¼ˆv2.0ï¼‰

| åœºæ™¯       | v2.0 è¡Œä¸º | ç”¨æˆ·æ”¶ç›Š      |
|----------|---------|-----------|
| æƒ³ä¸ºå•ä¸ªæ–¹æ³•ç”Ÿæˆ | åªä¸ºè¯¥æ–¹æ³•ç”Ÿæˆ | âœ… ç²¾ç¡®æ§åˆ¶    |
| æƒ³ä¸ºå•ä¸ªå­—æ®µç”Ÿæˆ | åªä¸ºè¯¥å­—æ®µç”Ÿæˆ | âœ… èŠ‚çœæ—¶é—´å’Œæˆæœ¬ |
| æƒ³ä¸ºä¸€ä¸ªç±»ç”Ÿæˆ  | åªä¸ºè¯¥ç±»ç”Ÿæˆ  | âœ… ç²¾ç¡®ä¸”é«˜æ•ˆ   |
| æƒ³ä¸ºæ•´ä¸ªæ–‡ä»¶ç”Ÿæˆ | å…‰æ ‡æ”¾æ–‡ä»¶é¡¶éƒ¨ | âœ… ä»ç„¶æ”¯æŒ    |

---

## ğŸ¨ UI/UX æ”¹è¿›

### è¿›åº¦æç¤º

```
æ—§ç‰ˆæœ¬ï¼šç”Ÿæˆ JavaDoc
æ–°ç‰ˆæœ¬ï¼šç”Ÿæˆ JavaDoc - æ–¹æ³•: calculateSum()
```

**å¥½å¤„**ï¼šç”¨æˆ·æ¸…æ¥šçŸ¥é“æ­£åœ¨ä¸ºå“ªä¸ªå…ƒç´ ç”Ÿæˆ

---

### å®Œæˆæç¤º

```
æ—§ç‰ˆæœ¬ï¼š
æ–‡æ¡£ç”Ÿæˆå®Œæˆï¼
æˆåŠŸ: 5
å¤±è´¥: 0
è·³è¿‡: 0

æ–°ç‰ˆæœ¬ï¼š
æ–¹æ³•: calculateSum() æ–‡æ¡£ç”Ÿæˆå®Œæˆï¼
æˆåŠŸ: 1
å¤±è´¥: 0
è·³è¿‡: 0
```

**å¥½å¤„**ï¼šæ›´æ¸…æ™°çš„åé¦ˆ

---

### Intention Action

**æ˜¾ç¤ºæ¡ä»¶ä¼˜åŒ–**ï¼š

- âŒ å·²æœ‰ JavaDoc â†’ ä¸æ˜¾ç¤º
- âŒ æ–‡ä»¶çº§åˆ« â†’ ä¸æ˜¾ç¤ºï¼ˆé¿å…ä¸å…¶ä»–å…¥å£é‡å¤ï¼‰
- âœ… æ–¹æ³•ã€å­—æ®µã€ç±» â†’ æ˜¾ç¤º

**å•ä¸ªå…ƒç´ ä¼˜åŒ–**ï¼š

- å¦‚æœåªæœ‰ä¸€ä¸ªä»»åŠ¡ä¸”æˆåŠŸï¼Œä¸æ˜¾ç¤ºç»Ÿè®¡å¼¹çª—
- ç›´æ¥å®Œæˆï¼Œç”¨æˆ·ä½“éªŒæ›´æµç•…

---

## ğŸ§ª æµ‹è¯•åœºæ™¯

### æµ‹è¯•ç”¨ä¾‹

#### 1. æ–¹æ³•å®šä½æµ‹è¯•

```java
public class Test {
    // å…‰æ ‡åœ¨æ–¹æ³•ç­¾åä»»æ„ä½ç½®
    public void testMethod() {  // â† è¿™é‡Œ
        int a = 1;
        int b = 2;  // æˆ–è¿™é‡Œ
    }
}
```

**é¢„æœŸ**ï¼šåªä¸º `testMethod` ç”Ÿæˆ JavaDoc

---

#### 2. å­—æ®µå®šä½æµ‹è¯•

```java
public class Test {
    private String field1;  // â† å…‰æ ‡è¿™é‡Œ
    private int field2;
}
```

**é¢„æœŸ**ï¼šåªä¸º `field1` ç”Ÿæˆ JavaDoc

---

#### 3. ç±»å®šä½æµ‹è¯•ï¼ˆç±»åï¼‰

```java
public class Test {  // â† å…‰æ ‡åœ¨ç±»åä¸Š
    private String field;
    public void method() {}
}
```

**é¢„æœŸ**ï¼šä¸ºç±»ã€å­—æ®µã€æ–¹æ³•éƒ½ç”Ÿæˆ JavaDoc

---

#### 4. ç±»å®šä½æµ‹è¯•ï¼ˆå†…éƒ¨ï¼‰

```java
public class Test {
    // å…‰æ ‡åœ¨è¿™é‡Œï¼ˆç±»å†…éƒ¨ç©ºç™½å¤„ï¼‰
    private String field;
    public void method() {}
}
```

**é¢„æœŸ**ï¼šä¸ºç±»ã€å­—æ®µã€æ–¹æ³•éƒ½ç”Ÿæˆ JavaDoc

---

#### 5. å¤šä¸ªç±»æµ‹è¯•

```java
public class Class1 {
    public void method1() {}  // â† å…‰æ ‡è¿™é‡Œ
}

class Class2 {
    public void method2() {}
}
```

**é¢„æœŸ**ï¼šåªä¸º `method1` ç”Ÿæˆ JavaDocï¼Œ`Class2` å’Œ `method2` ä¸å—å½±å“

---

#### 6. åµŒå¥—ç±»æµ‹è¯•

```java
public class Outer {
    public void outerMethod() {}
    
    class Inner {  // â† å…‰æ ‡åœ¨è¿™é‡Œ
        public void innerMethod() {}
    }
}
```

**é¢„æœŸ**ï¼šä¸º `Inner` ç±»åŠ `innerMethod` ç”Ÿæˆ JavaDoc

---

#### 7. å·²æœ‰ JavaDoc æµ‹è¯•

```java
public class Test {
    /**
     * å·²æœ‰æ³¨é‡Š
     */
    public void method1() {}  // â† å…‰æ ‡è¿™é‡Œ
    
    public void method2() {}
}
```

**é¢„æœŸ**ï¼š

- å¿«æ·é”®/å³é”®ï¼šæç¤º"å½“å‰å…ƒç´ å·²æœ‰æ–‡æ¡£"
- Intention Actionï¼šä¸æ˜¾ç¤º

---

## ğŸ“ é…ç½®é¡¹

æ™ºèƒ½å®šä½åŠŸèƒ½ä¼šéµå¾ªè®¾ç½®é¢æ¿ä¸­çš„é…ç½®ï¼š

```java
// SettingsState.java
public boolean generateForClass = true;    // æ˜¯å¦ä¸ºç±»ç”Ÿæˆ
public boolean generateForMethod = true;   // æ˜¯å¦ä¸ºæ–¹æ³•ç”Ÿæˆ
public boolean generateForField = true;    // æ˜¯å¦ä¸ºå­—æ®µç”Ÿæˆ
public boolean skipExisting = true;        // è·³è¿‡å·²æœ‰æ–‡æ¡£
```

**è¡Œä¸º**ï¼š

- å¦‚æœ `skipExisting = true`ï¼Œå·²æœ‰ JavaDoc çš„å…ƒç´ ä¼šè¢«è·³è¿‡
- å¦‚æœ `generateForMethod = false`ï¼Œå³ä½¿å®šä½åˆ°æ–¹æ³•ä¹Ÿä¸ä¼šç”Ÿæˆ

---

## ğŸ”„ ä¸åŸæœ‰åŠŸèƒ½çš„å…¼å®¹æ€§

### æ–‡ä»¶/ç›®å½•æ‰¹é‡å¤„ç†

**ä¸å—å½±å“**ï¼š`GenerateJavaDocForSelectionAction` ä»ç„¶ä¸ºé€‰ä¸­çš„æ‰€æœ‰æ–‡ä»¶æ‰¹é‡ç”Ÿæˆ

---

### å‘åå…¼å®¹

**Legacy å¿«æ·é”®**ï¼š`Action.java` å·²æ›´æ–°ä¸ºä½¿ç”¨æ™ºèƒ½å®šä½ï¼Œä½†ä¿ç•™å‘åå…¼å®¹

---

## âœ… å®ç°å®Œæˆæ¸…å•

- [x] âœ… åˆ›å»º `PsiElementLocator` å·¥å…·ç±»
- [x] âœ… å¢å¼º `TaskCollector.collectFromElement()`
- [x] âœ… æ›´æ–° `Action.java`ï¼ˆå¿«æ·é”®ï¼‰
- [x] âœ… æ›´æ–° `GenerateJavaDocForFileAction.java`ï¼ˆç¼–è¾‘å™¨å³é”®ï¼‰
- [x] âœ… æ›´æ–° `GenerateJavaDocGenerateAction.java`ï¼ˆGenerate èœå•ï¼‰
- [x] âœ… åˆ›å»º `GenerateJavaDocIntentionAction.java`ï¼ˆIntention Actionï¼‰
- [x] âœ… åœ¨ `plugin.xml` ä¸­æ³¨å†Œ Intention Action
- [x] âœ… åˆ›å»º Intention Action æè¿°æ–‡ä»¶
- [x] âœ… æ‰€æœ‰å…¥å£ç»Ÿä¸€ä½¿ç”¨æ™ºèƒ½å®šä½é€»è¾‘

